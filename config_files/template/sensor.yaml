- sensor:
  - name: remote_state
    unique_id: remote_state
    state: '{{ states.remote.harmony_hub_2.attributes.current_activity }}'
  - name: Anzahl Automationen
    unique_id: count_automation
    state: '{{ states.automation | count }}'
  - name: Anzahl Skripte
    unique_id: count_script
    state: '{{ states.script | count }}'

  - name: nextcloud_latest_version
    unique_id: nextcloud_latest_version
    state: >
        {%
        if (states('binary_sensor.nextcloud_update_status') == 'on' )
        %}
          {%
            if ( 'Nextcloud' in state_attr('sensor.nextcloud_update', 'desc') )
          %}
            {{ (state_attr('sensor.nextcloud_update', 'desc').split(" ")[1]) }}
          {% else %}
            {{ states('sensor.nextcloud_version')}}
          {% endif %}
        {% else %}
          {{ states('sensor.nextcloud_version')}}
        {% endif %}


##### smart meter ######
  - name: total_consumtion
    unique_id: total_consumtion
    state: >
          {% set wh = states('sensor.smart_meter_positive_wirkenergie_insgesamt') | float %}
          {{ ((wh) / 1000) | round(1, default=0) }}
    state_class: total
    unit_of_measurement: 'kWh'

  - name: total_feed
    unique_id: total_feed
    state: >
          {% set wh = states('sensor.smart_meter_negative_wirkenergie_insgesamt') | float %}
          {{ ((wh) / 1000) | round(1, default=0) }}
    state_class: total
    unit_of_measurement: 'kWh'