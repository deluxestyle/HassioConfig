- sensor:
##### smart meter ######
  - name: total_consumtion
    unique_id: total_consumtion
    state: >
          {% set wh = states('sensor.smart_meter_positive_wirkenergie_insgesamt') | float %}
          {{ ((wh) / 1000) | round(1, default=0) }}
    state_class: total
    unit_of_measurement: 'kWh'

  - name: total_feed
    unique_id: total_feed
    state: >
          {% set wh = states('sensor.smart_meter_negative_wirkenergie_insgesamt') | float %}
          {{ ((wh) / 1000) | round(1, default=0) }}
    state_class: total
    unit_of_measurement: 'kWh'

  - name: daily_usage
    unique_id: daily_usage
    state: >
          {% set tmp1 = states.var.daily_consumption.state | float %}
          {% set tmp2 = states.sensor.smart_meter_positive_wirkenergie_insgesamt.state | float %}
          {{ tmp2 - tmp1 }}
    state_class: measurement
    unit_of_measurement: 'W'

  - name: daily_feed
    unique_id: daily_ufeed
    state: >
          {% set tmp1 = states.var.daily_feed.state | float %}
          {% set tmp2 = states.sensor.smart_meter_negative_wirkenergie_insgesamt.state | float %}
          {{ tmp2 - tmp1 }}
    state_class: measurement
    unit_of_measurement: 'W'